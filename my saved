using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Configuration;
using static System.Windows.Forms.VisualStyles.VisualStyleElement.Button;
using static System.Windows.Forms.VisualStyles.VisualStyleElement;

namespace WindowsFormsApp1
{
    public partial class Form1 : Form
    {
        private Size formOriginalSize;
        private Rectangle Name_layout;
        private Rectangle Name_lbl;
        private Rectangle Street_layout;
        private Rectangle Street_lbl;
        private Rectangle City_layout;
        private Rectangle City_lbl;
        private Rectangle State_layout;
        private Rectangle State_lbl;
        private Rectangle ZIP_layout;
        private Rectangle ZIP_lbl;
        private Rectangle Clear_layout;
        private Rectangle Save_layout;
        private Rectangle Drop_layout;
        private Rectangle Pattern_layout;
        private Rectangle Pattern_lbl;
        private Rectangle Remove_layout;
        private Rectangle Datagrid_layout;
        SqlConnection con = new SqlConnection("Data Source=(localdb)\\Local;Initial Catalog=Ecubix_training;Integrated Security=True;Encrypt=False");
        SqlCommand cmd;
        SqlDataAdapter adapt;
       
        public Form1()
        {
            InitializeComponent();
            this.Resize += Form1_Resiz;
            formOriginalSize = this.Size;
            Name_layout = new Rectangle(Name_box.Location, Name_box.Size);
            Name_lbl = new Rectangle(Name_lable.Location, Name_lable.Size);

            Street_layout = new Rectangle(Street_box.Location, Street_box.Size);
            Street_lbl = new Rectangle(Street_lable.Location, Street_lable.Size);

            City_layout = new Rectangle(City_box.Location, City_box.Size);
            City_lbl = new Rectangle(City_lable.Location, City_lable.Size);

            State_layout = new Rectangle(State_box.Location, State_box.Size);
            State_lbl = new Rectangle(State_lable.Location, State_lable.Size);

            ZIP_layout = new Rectangle(ZIP_box.Location, ZIP_box.Size);
            ZIP_lbl = new Rectangle(ZIP_lable.Location, ZIP_lable.Size);

            Clear_layout = new Rectangle(Clear_btn.Location, Clear_btn.Size);

            Save_layout = new Rectangle(Save_btn.Location, Save_btn.Size);

            Drop_layout = new Rectangle(comboBox1.Location, comboBox1.Size);

            Pattern_layout = new Rectangle(Pattern_box.Location, Pattern_box.Size);
            Pattern_lbl = new Rectangle(Pattern_lable.Location, Pattern_lable.Size);

            Remove_layout = new Rectangle(Remove_btn.Location, Remove_btn.Size);

            Datagrid_layout = new Rectangle(dataGridView1.Location, dataGridView1.Size);

            Name_box.Multiline = true;
            Street_box.Multiline = true;
            City_box.Multiline = true;
            State_box.Multiline = true;
            ZIP_box.Multiline = true;
            Pattern_box.Multiline = true;

            Display();

        }

            private void Form1_Resiz(object sender, EventArgs e)
            {
                resize_Control(Name_box, Name_layout);
                resize_Control(Name_lable, Name_lbl);

                resize_Control(Street_box, Street_layout);
                resize_Control(Street_lable, Street_lbl);

                resize_Control(City_box, City_layout);
                resize_Control(City_lable, City_lbl);

                resize_Control(State_box, State_layout);
                resize_Control(State_lable, State_lbl);

                resize_Control(ZIP_box, ZIP_layout);
                resize_Control(ZIP_lable, ZIP_lbl);

                resize_Control(Clear_btn, Clear_layout);
                resize_Control(Save_btn, Save_layout);

                resize_Control(comboBox1, Drop_layout);

                resize_Control(Pattern_box, Pattern_layout);
                resize_Control(Pattern_lable, Pattern_lbl);

                resize_Control(Remove_btn, Remove_layout);

                resize_Control(dataGridView1, Datagrid_layout);


            }
            private void resize_Control(Control c, Rectangle r)
            {
                float xRatio = (float)(this.Width) / (float)(formOriginalSize.Width);
                float yRatio = (float)(this.Height) / (float)(formOriginalSize.Height);
                int newX = (int)(r.X * xRatio);
                int newY = (int)(r.Y * yRatio);

                int newWidth = (int)(r.Width * xRatio);
                int newHeight = (int)(r.Height * yRatio);

                c.Location = new Point(newX, newY);
                c.Size = new Size(newWidth, newHeight);

            }
        public void Display()
        {
            SqlCommand showq = new SqlCommand("Select * from Training_1", con);
            SqlDataAdapter data = new SqlDataAdapter(showq);
            DataTable dt = new DataTable();
            data.Fill(dt);
            dataGridView1.DataSource = dt;
        }
        public void clean()
            {
                Name_box.Clear();
                Street_box.Clear();
                City_box.Clear();
                State_box.Clear();
                ZIP_box.Clear();
            }

            private void Name_lable_Click(object sender, EventArgs e)
            {

            }

            private void Name_box_TextChanged(object sender, EventArgs e)
            {

            }

            private void Street_box_TextChanged(object sender, EventArgs e)
            {

            }

            private void City_box_TextChanged(object sender, EventArgs e)
            {

            }

            private void State_box_TextChanged(object sender, EventArgs e)
            {

            }

            private void ZIP_box_TextChanged(object sender, EventArgs e)
            {

            }

            private void listBox1_SelectedIndexChanged(object sender, EventArgs e)
            {

            }

            private void Street_lable_Click(object sender, EventArgs e)
            {

            }

            private void City_lable_Click(object sender, EventArgs e)
            {

            }

            private void State_lable_Click(object sender, EventArgs e)
            {

            }

            private void ZIP_lable_Click(object sender, EventArgs e)
            {

            }

            private void Clear_btn_Click(object sender, EventArgs e)
            {
                clean();
            }

            private void Remove_btn_Click(object sender, EventArgs e)
            {


                con.Open();
                int id = Convert.ToInt32(dataGridView1.SelectedRows[0].Cells["ID"].Value);
                //MessageBox.Show(Convert.ToString(id));
                cmd = new SqlCommand($"DELETE FROM Training_1 WHERE ID = {id}", con);


                //cmd.Parameters.AddWithValue("@id", id);
                cmd.ExecuteNonQuery();

                //cmd = new SqlCommand("Select * from Training_1", con);
                //cmd.ExecuteNonQuery();

                //
                Display();
                //
                con.Close();
                MessageBox.Show("Record Deleted Successfully!");
            }

            private void Save_btn_Click(object sender, EventArgs e)
            {
                try
                {
                    con.Open();

                    cmd = new SqlCommand("Insert into Training_1 values (@NAME ,@STREET,@CITY,@STATE,@ZIP)", con);

                    cmd.Parameters.AddWithValue("@NAME", Name_box.Text);
                    cmd.Parameters.AddWithValue("STREET", Street_box.Text);
                    cmd.Parameters.AddWithValue("@CITY", City_box.Text);
                    cmd.Parameters.AddWithValue("@STATE", State_box.Text);
                    cmd.Parameters.AddWithValue("@ZIP", int.Parse(ZIP_box.Text));

                    if (string.IsNullOrWhiteSpace(Name_box.Text) || string.IsNullOrWhiteSpace(Street_box.Text) || string.IsNullOrWhiteSpace(City_box.Text) || string.IsNullOrWhiteSpace(State_box.Text) || string.IsNullOrWhiteSpace(ZIP_box.Text))
                    {
                        MessageBox.Show("Please enter all the details");
                    }
                    else
                    {
                        cmd.ExecuteNonQuery();
                        Display();
                        MessageBox.Show("Data is successfully saved");
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"An error occurred: {ex.Message}");
                }
                finally
                {
                    if (con.State == ConnectionState.Open)
                    {
                        con.Close();
                    }
                }
            }

            public void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
            {
                //string drop=comboBox1.GetItemText(comboBox1.SelectedItem);
            }

        private void Pattern_box_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                try
                {
                    con.Open();
                    cmd = new SqlCommand($"SELECT * FROM Training_1 WHERE {comboBox1.SelectedItem} LIKE @Pattern", con);
                    cmd.Parameters.AddWithValue("@Pattern", $"%{Pattern_box.Text}%");

                    SqlDataAdapter data = new SqlDataAdapter(cmd);
                    DataTable dt = new DataTable();
                    data.Fill(dt);
                    dataGridView1.DataSource = dt;
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"An error occurred: {ex.Message}");
                }
                finally
                {
                    con.Close();
                }
          
            }

            

        }

        private void Refresh_btn_Click(object sender, EventArgs e)
        {
            con.Open();
            Display();
            con.Close();
        }

        private void Download_btn_Click(object sender, EventArgs e)
        {



        }

    }
}
   
